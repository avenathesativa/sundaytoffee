<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order | Sunday Toffee</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-brown: #786043;
            --primary-brown-dark: #5D4A33;
            --bg-cream: #F9F5EF;
            --dark-text: #393939;
            --light-text: #676767;
            --accent-tan: #F2E0C9;
            --border-tan: #E8D5D2;
        }
        body {
            font-family: 'Inter', sans-serif;
            color: var(--dark-text);
            background-color: var(--bg-cream);
            line-height: 1.6;
            font-weight: 300;
        }
        nav { padding: 2rem 8%; display: flex; justify-content: space-between; align-items: center; max-width: 1100px; margin: 0 auto; }
        .logo { font-family: 'Libre Baskerville', serif; font-size: 1.3rem; color: var(--primary-brown); text-decoration: none; }
        .nav-links { display: flex; gap: 2rem; list-style: none; }
        .nav-links a { text-decoration: none; color: var(--light-text); font-size: 0.9rem; }
        .order-page { max-width: 550px; margin: 0 auto; padding: 2rem 1.5rem 5rem; }
        .page-header { text-align: center; margin-bottom: 2rem; }
        .page-title { font-family: 'Libre Baskerville', serif; font-size: 2.2rem; font-weight: 400; color: var(--primary-brown); margin-bottom: 1rem; }
        .section { margin-top: 3rem; }
        .section-title { font-family: 'Libre Baskerville', serif; font-size: 1.3rem; color: var(--primary-brown); border-bottom: 1px solid var(--border-tan); padding-bottom: 0.75rem; margin-bottom: 1.5rem; }
        .product-card { background: white; border-radius: 8px; padding: 1.25rem; display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .qty-controls { display: flex; align-items: center; gap: 1rem; }
        .qty-btn { width: 36px; height: 36px; border: 1px solid var(--border-tan); border-radius: 50%; background: white; color: var(--primary-brown); cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .qty-btn:hover { background: var(--accent-tan); }
        .total-bar { background: var(--accent-tan); border-radius: 8px; padding: 1rem 1.25rem; display: flex; justify-content: space-between; margin-top: 1rem; color: var(--primary-brown); font-weight: 500; font-size: 1.1rem; }
        .info-box { background: white; border-left: 3px solid var(--primary-brown); padding: 1.25rem; border-radius: 0 8px 8px 0; margin-bottom: 1.5rem; }
        .address-link { color: inherit; text-decoration: none; }
        .address-link:hover { text-decoration: underline; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; font-size: 0.85rem; margin-bottom: 0.6rem; color: var(--dark-text); font-weight: 400; }
        input, textarea { width: 100%; padding: 0.9rem 1rem; border: 1px solid var(--border-tan); border-radius: 8px; font-family: 'Inter', sans-serif; font-size: 0.95rem; background: white; }
        .radio-group { display: flex; flex-direction: column; gap: 1rem; }
        .radio-option { display: flex; align-items: center; gap: 0.75rem; cursor: pointer; font-size: 0.95rem; color: var(--dark-text); }
        .radio-option input { width: 18px; height: 18px; accent-color: var(--primary-brown); cursor: pointer; }
        .radio-option.disabled { opacity: 0.3; pointer-events: none; }
        .handle-detail { color: var(--light-text); font-size: 0.85rem; }
        .method-details { display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed var(--border-tan); }
        .method-details.active { display: block; }
        .btn-submit { width: 100%; padding: 1.1rem; background: var(--primary-brown); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; margin-top: 2.5rem; transition: background 0.2s; }
        .btn-submit:hover { background: var(--primary-brown-dark); }
        #confirmation { display: none; text-align: center; padding: 4rem 0; }
        #confirmation.show { display: block; }
        .summary-list { margin-top: 1.5rem; font-size: 0.95rem; text-align: left; }
        .summary-item { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee; }
        footer { text-align: center; padding: 4rem 0; }
    </style>
</head>
<body>
    <nav>
        <a href="index.html" class="logo">sunday toffee</a>
        <ul class="nav-links">
            <li><a href="index.html#products">what i make</a></li>
            <li><a href="index.html#about">about</a></li>
            <li><a href="order.html">order</a></li>
        </ul>
    </nav>
    <div class="order-page">
        <div id="formContainer">
            <div class="page-header">
                <h1 class="page-title">place your order</h1>
                <p style="color: var(--light-text); font-size: 0.95rem;">Buttery, crunchy toffee filled with almonds, covered in rich chocolate, and topped with toasted nuts.</p>
                <p style="color: var(--light-text); font-size: 0.85rem; margin-top: 0.75rem; font-style: italic;">Orders by Saturday at 3PM help me plan ahead, but I'm flexible!</p>
            </div>
            <form id="orderForm">
                <div class="section">
                    <h2 class="section-title">choose your toffee</h2>
                    <div class="product-card">
                        <div><h3 style="font-family: 'Libre Baskerville'; font-weight: 400;">8 oz box</h3><p style="color: var(--primary-brown);">$10</p></div>
                        <div class="qty-controls">
                            <button type="button" class="qty-btn" onclick="updateQty('eight', -1)">−</button>
                            <span id="qty-eight">0</span>
                            <button type="button" class="qty-btn" onclick="updateQty('eight', 1)">+</button>
                        </div>
                    </div>
                    <div class="product-card">
                        <div><h3 style="font-family: 'Libre Baskerville'; font-weight: 400;">4 oz box</h3><p style="color: var(--primary-brown);">$5</p></div>
                        <div class="qty-controls">
                            <button type="button" class="qty-btn" onclick="updateQty('four', -1)">−</button>
                            <span id="qty-four">0</span>
                            <button type="button" class="qty-btn" onclick="updateQty('four', 1)">+</button>
                        </div>
                    </div>
                    <div class="total-bar"><span>order total</span><span id="total-display">$0</span></div>
                </div>
                <div class="section">
                    <h2 class="section-title">your info</h2>
                    <div class="form-group"><label>name</label><input type="text" id="name" placeholder="Your name" required></div>
                    <div class="form-group">
                        <label>email</label>
                        <input type="email" id="email" placeholder="you@example.com" required 
                               pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" 
                               title="Please enter a valid email address (e.g., name@domain.com)">
                    </div>
                    <div class="form-group"><label>phone</label><input type="tel" id="phone" placeholder="(555) 123-4567" required></div>
                </div>
                <div class="section">
                    <h2 class="section-title">how to get it</h2>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="method" value="Pickup" required onclick="toggleMethod('pickup')" checked> 
                            <span>Pickup (Upper Market in San Francisco)</span>
                        </label>
                        <label class="radio-option" id="deliveryLabel" style="opacity: 0.4; cursor: not-allowed;">
                            <input type="radio" name="method" id="deliveryRadio" value="Delivery" onclick="toggleMethod('delivery')" disabled> 
                            <span>Delivery (Free and available for orders $100+ in San Francisco)</span>
                        </label>
                    </div>
                    <div id="pickupDetails" class="method-details active">
                        <div class="info-box">
                            <p style="font-weight: 500; color: var(--primary-brown);">
                                <a href="https://maps.app.goo.gl/EZmuY7BPceEqVesBA" target="_blank" class="address-link">3639 Market Street, San Francisco, CA 94131</a>
                            </p>
                            <p style="font-style: italic; font-size: 0.85rem; color: var(--light-text);">Ring the first door bell when you get here!</p>
                        </div>
                        <label>pickup window (<span id="pickupDate"></span>)</label>
                        <script>
                            // Set pickup date immediately
                            (function() {
                                const today = new Date();
                                const dayOfWeek = today.getDay();
                                const daysUntilSunday = dayOfWeek === 0 ? 7 : (7 - dayOfWeek);
                                const upcomingSunday = new Date(today);
                                upcomingSunday.setDate(today.getDate() + daysUntilSunday);
                                const options = { weekday: 'long', month: 'long', day: 'numeric' };
                                document.getElementById('pickupDate').textContent = upcomingSunday.toLocaleDateString('en-US', options);
                            })();
                        </script>
                        <div class="radio-group">
                            <label class="radio-option"><input type="radio" name="window" value="9AM - 12PM"> <span>9AM - 12PM</span></label>
                            <label class="radio-option"><input type="radio" name="window" value="3PM - 6PM"> <span>3PM - 6PM</span></label>
                        </div>
                    </div>
                    <div id="deliveryDetails" class="method-details">
                        <div class="form-group">
                            <label>delivery address</label>
                            <p style="font-size: 0.85rem; color: var(--light-text); margin-bottom: 0.5rem;">Your order qualifies for free delivery in San Francisco!</p>
                            <textarea id="address" placeholder="Enter your San Francisco address"></textarea>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">payment</h2>
                    <div class="radio-group">
                        <label class="radio-option"><input type="radio" name="pay" value="Venmo" required> <span>Venmo <span class="handle-detail">(@oats123)</span></span></label>
                        <label class="radio-option"><input type="radio" name="pay" value="Zelle"> <span>Zelle <span class="handle-detail">(avenajiajia@gmail.com)</span></span></label>
                        <label class="radio-option"><input type="radio" name="pay" value="Cash"> <span>Cash <span class="handle-detail">(i pinky promise to pay at pick up)</span></span></label>
                    </div>
                </div>
                <button type="submit" class="btn-submit" id="submitBtn">place order</button>
            </form>
        </div>
        <div id="confirmation">
            <h1 class="page-title">order received!</h1>
            <p style="color: var(--light-text);">See you soon! Here is what I have:</p>
            <div class="info-box" style="margin-top: 2rem; border-left-color: var(--primary-brown);">
                <h3 style="font-family: 'Libre Baskerville'; font-size: 1rem; margin-bottom: 0.5rem;">Order Summary</h3>
                <div id="summaryContent" class="summary-list"></div>
            </div>
            <div class="info-box" style="border-left-color: #A38C75; background: #faf8f5;">
                <p style="font-weight: 500; color: var(--primary-brown);">Payment Reminder</p>
                <p style="font-size: 0.9rem;">Venmo: @oats123 (last 4 digits: 7476)</p>
                <p style="font-size: 0.9rem;">Zelle: avenajiajia@gmail.com</p>
            </div>
            <a href="index.html" style="display: inline-block; margin-top: 2rem; color: var(--primary-brown); text-decoration: none; font-weight: 500;">← back to home</a>
        </div>
    </div>
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        let quantities = { eight: 0, four: 0 };
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwT-mQefx2FonndoDe81zB0WGZJAh3A-s0Cc3nX5e6hmg0BN9KnEIrc4nqjpoWLqkZBSg/exec';

        // Calculate upcoming Sunday
        function getUpcomingSunday() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            // If today is Sunday, get next Sunday (7 days from now)
            // Otherwise, get the upcoming Sunday
            const daysUntilSunday = dayOfWeek === 0 ? 7 : (7 - dayOfWeek);
            
            const upcomingSunday = new Date(today);
            upcomingSunday.setDate(today.getDate() + daysUntilSunday);
            
            // Format as "Sunday, February 16"
            const options = { weekday: 'long', month: 'long', day: 'numeric' };
            return upcomingSunday.toLocaleDateString('en-US', options);
        }

        function updateQty(type, change) {
            quantities[type] = Math.max(0, quantities[type] + change);
            document.getElementById(`qty-${type}`).innerText = quantities[type];
            const total = (quantities.eight * 10) + (quantities.four * 5);
            document.getElementById('total-display').innerText = `$${total}`;
            const radio = document.getElementById('deliveryRadio');
            const label = document.getElementById('deliveryLabel');
            if (total >= 100) {
                radio.disabled = false; label.style.opacity = "1"; label.style.cursor = "pointer";
            } else {
                if (radio.checked) { document.querySelector('input[value="Pickup"]').checked = true; toggleMethod('pickup'); }
                radio.disabled = true; label.style.opacity = "0.4"; label.style.cursor = "not-allowed";
            }
        }
        function toggleMethod(m) {
            const pickupDetails = document.getElementById('pickupDetails');
            const deliveryDetails = document.getElementById('deliveryDetails');
            const addressField = document.getElementById('address');
            if (m === 'pickup') {
                pickupDetails.classList.add('active'); deliveryDetails.classList.remove('active');
                addressField.required = false; addressField.value = "";
            } else {
                pickupDetails.classList.remove('active'); deliveryDetails.classList.add('active');
                addressField.required = true; document.querySelectorAll('input[name="window"]').forEach(i => i.checked = false);
            }
        }
        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const total = (quantities.eight * 10) + (quantities.four * 5);
            if (total === 0) { alert('Select a box!'); return; }
            const method = document.querySelector('input[name="method"]:checked').value;
            const address = document.getElementById('address').value;
            if (method === 'Delivery' && (!address || address.trim() === "")) { alert('Please enter a delivery address.'); return; }
            const btn = document.getElementById('submitBtn'); btn.disabled = true; btn.textContent = 'submitting...';
            const name = document.getElementById('name').value;
            const window = document.querySelector('input[name="window"]:checked')?.value || 'N/A';
            const pay = document.querySelector('input[name="pay"]:checked').value;
            document.getElementById('summaryContent').innerHTML = `<div class="summary-item"><span>Name:</span><span>${name}</span></div><div class="summary-item"><span>8 oz boxes:</span><span>${quantities.eight}</span></div><div class="summary-item"><span>4 oz boxes:</span><span>${quantities.four}</span></div><div class="summary-item"><span>Total:</span><span>$${total}</span></div><div class="summary-item"><span>Method:</span><span>${method}</span></div>${method === 'Pickup' ? `<div class="summary-item"><span>Window:</span><span>${window}</span></div>` : `<div class="summary-item"><span>Address:</span><span>${address}</span></div>`}<div class="summary-item"><span>Payment:</span><span>${pay}</span></div>`;
            try {
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ name, email: document.getElementById('email').value, phone: document.getElementById('phone').value, eight_oz: quantities.eight, four_oz: quantities.four, method, window: window, address, payment: pay, total }) });
                document.getElementById('formContainer').style.display = 'none';
                document.getElementById('confirmation').classList.add('show');
            } catch (error) {
                alert('There was an error submitting your order. Please try again or contact us directly.');
                btn.disabled = false; btn.textContent = 'place order';
            }
        });
    </script>
</body>
</html>